<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Vaishali || Home</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="img/favicon.png">

    <!-- Normalize CSS -->
    <link rel="stylesheet" href="css/normalize.css">

    <!-- Main CSS -->
    <link rel="stylesheet" href="css/main.css">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">

    <!-- Animate CSS -->
    <link rel="stylesheet" href="css/animate.min.css">

    <!-- Font-awesome CSS-->
    <link rel="stylesheet" href="css/font-awesome.min.css">

    <!-- Owl Caousel CSS -->
    <link rel="stylesheet" href="vendor/OwlCarousel/owl.carousel.min.css">
    <link rel="stylesheet" href="vendor/OwlCarousel/owl.theme.default.min.css">

    <!-- Main Menu CSS -->
    <link rel="stylesheet" href="css/meanmenu.min.css">

    <!-- nivo slider CSS -->
    <link rel="stylesheet" href="vendor/slider/css/nivo-slider.css" type="text/css"/>
    <link rel="stylesheet" href="vendor/slider/css/preview.css" type="text/css" media="screen"/>

    <!-- Datetime Picker Style CSS -->
    <link rel="stylesheet" href="css/jquery.datetimepicker.css">

    <!-- Switch Style CSS -->
    <link rel="stylesheet" href="css/switch-style.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">

    <!-- Modernizr Js -->
    <script src="js/modernizr-2.8.3.min.js"></script>

</head>

<body>
<div class="wrapper">

    <header>
        <div class="header2-area">
            <div class="header-top-area">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                            <div class="header-top-left">
                                <ul>
                                    <li><i class="fa fa-phone" aria-hidden="true"></i><a href="Tel:+1234567890"> + 123
                                        456 78910 </a></li>
                                    <li><i class="fa fa-envelope" aria-hidden="true"></i><a
                                            href="#">info@Restaurant.com</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                            <div class="header-top-right jtv-user-info">
                                <ul>


                                    <li class="dropdown"><a class="current-open" data-toggle="dropdown"
                                                            aria-haspopup="true" aria-expanded="false" href="#"><span><i
                                            class="fa fa-user" aria-hidden="true"></i> My Account </span> <i
                                            class="fa fa-angle-down"></i></a>
                                        <ul class="dropdown-menu" role="menu">
                                            <li><a href="account_page.html">Account</a></li>
                                            <li><a href="checkout.html">Checkout</a></li>
                                            <li class="divider"></li>
                                            <li><a href="#" data-toggle="modal" data-target="#Restaurant_login"><i
                                                    class="fa fa-user" aria-hidden="true"></i> Log In</a></li>
                                            <li><a href="#" data-toggle="modal" data-target="#Restaurant_signup"><i
                                                    class="fa fa-user" aria-hidden="true"></i> Sign Up</a></li>
                                        </ul>
                                    </li>


                                    <li><a href="#" data-toggle="modal" data-target="#Restaurant_signup"><i
                                            class="fa fa-user" aria-hidden="true"></i> Sign Up</a></li>
                                    <li><a href="#" data-toggle="modal" data-target="#Restaurant_login"><i
                                            class="fa fa-user" aria-hidden="true"></i> Login</a></li>
                                    <li><a href="#"><i class="fa fa-facebook" aria-hidden="true"></i></a></li>
                                    <li><a href="#"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
                                    <li><a href="#"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li>
                                    <li><a href="#"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="header-bottom-area" id="sticker">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-2 col-md-2 col-sm-2 col-xs-12">
                            <div class="logo-area">
                                <a href="index.html"><img class="img-responsive" src="img/logo-color.png"
                                                          alt="logo"></a>
                            </div>
                        </div>
                        <div class="col-lg-8 col-md-8 col-sm-8 col-xs-12">
                            <div class="main-menu-area">
                                <nav>
                                    <ul>
                                        <li><a href="index.html">Home</a>

                                        </li>
                                        <li><a href="#">All Pages <i class="fa fa-angle-down"></i></a>
                                            <ul>
                                                <li><a href="index.html">Home</a></li>
                                                <li><a href="about1.html">About Us</a></li>
                                                <li><a href="our-recipes.html">Our Recipes</a></li>
                                                <li><a href="food-menu4.html">Food Menu</a></li>
                                                <li><a href="food_2.html">Food Menu</a></li>
                                                <li><a href="food-menu-details.html">Food Menu Detail</a></li>
                                                <li><a href="reservation.html">Reservation</a></li>
                                                <li><a href="cart.html">Cart</a></li>
                                                <li><a href="checkout.html">Checkout</a></li>
                                                <li><a href="accountpage.html">Account Page</a></li>
                                                <li><a href="contact.html">Contact</a></li>
                                            </ul>
                                        </li>
                                        <li><a href="#">Restaurant</a></li>
                                        <li><a href="#">Bakery</a></li>
                                        <li><a href="#">Sweets</a></li>

                                        <li><a href="#">Reservation</a></li>
                                        <li><a href="#">Contact</a></li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                        <div class="col-lg-2 col-md-2 col-sm-2 col-xs-12">
                            <ul class="header-cart-area">
                                <li class="header-search">
                                    <form>
                                        <input type="text" class="search-form" placeholder="Search...." required>
                                        <a href="#" class="search-button" id="search-button"><i class="fa fa-search"
                                                                                                aria-hidden="true"></i></a>
                                    </form>
                                </li>
                                <li>
                                    <div class="cart-area">
                                        <a href="#"><i aria-hidden="true" class="fa fa-shopping-cart"></i><span>2</span></a>
                                        <ul id="dataListRight"></ul>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Mobile Menu Area Start -->
        <div class="mobile-menu-area">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div class="mobile-menu">
                            <nav id="dropdown">
                                <ul>
                                    <li><a href="index.html">Home</a>

                                    </li>
                                    <li><a href="#">All Pages</a>
                                        <ul>
                                            <li><a href="index.html">Home</a></li>
                                            <li><a href="about1.html">About Us</a></li>
                                            <li><a href="our-recipes.html">Our Recipes</a></li>
                                            <li><a href="food-menu4.html">Food Menu</a></li>
                                            <li><a href="food_2.html">Food Menu</a></li>
                                            <li><a href="food-menu-details.html">Food Menu Detail</a></li>
                                            <li><a href="reservation.html">Reservation</a></li>
                                            <li><a href="cart.html">Cart</a></li>
                                            <li><a href="checkout.html">Checkout</a></li>
                                            <li><a href="accountpage.html">Account Page</a></li>
                                            <li><a href="contact.html">Contact</a></li>
                                        </ul>
                                    </li>
                                    <li><a href="#">Restaurant</a>

                                    </li>
                                    <li><a href="#">Bakery</a>

                                    </li>
                                    <li><a href="#">Sweets</a>

                                    </li>

                                    <li><a href="#">Reservation</a></li>
                                    <li><a href="#">Contact</a></li>

                                    <li><a href="#">My Account</a>
                                        <ul>
                                            <li><a href="#">Person Menu</a></li>
                                            <li><a href="#" data-toggle="modal" data-target="#Restaurant_signup"><i
                                                    class="fa fa-user" aria-hidden="true"></i> Sign Up</a></li>
                                            <li><a href="#" data-toggle="modal" data-target="#Restaurant_login"><i
                                                    class="fa fa-user" aria-hidden="true"></i> Log In</a></li>

                                        </ul>

                                    </li>


                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Mobile Menu Area End -->
    </header>


    <!-- Inner Page Banner Area Start Here -->
    <div class="inner-page-banner-area">
        <div class="container">
            <div class="pagination-area">
                <h2>Shopping Cart</h2>
                <ul>
                    <li><a href="#">Home -</a> /</li>
                    <li>Cart</li>
                </ul>
            </div>
        </div>
    </div>
    <!-- Inner Page Banner Area End Here -->

    <section class="cart_vaishali">
        <div class="container">
            <div class="row" style="padding:20px 0; overflow-y:hidden;">
                <div class="col-md-12 col-sm-12 col-xs-12">
                    <div class="row">
                        <table class="table table-responsive cart-table">
                            <thead>
                            <tr>
                                <th>圖片</th>
                                <th>商品名稱</th>
                                <th>價格</th>
                                <th>數量(只能手動輸入數字 + -按鈕未實作)</th>
                                <th>總和</th>
                                <th>移除</th>
                            </tr>
                            </thead>
                            <tbody id="dataList1"></tbody>
                        </table>
                        <a class="default-btn" href="#" type="type" onclick="update()">更新購物車</a>
                    </div>
                </div>
            </div>

            <div class="col-md-4 col-sm-12 col-xs-12 pull-right shopping_total_nmn">
                <div class="widget-header widget-header-sm">
                    <h3 class="widget-title">Cart Totals</h3>
                </div>
                <ul class="cart-total-list" id="dataList2"></ul>

<!--                <ul class="cart-total-list">-->
<!--                    <li>Subtotal<span class="cart-total-amount">Rs.650</span>-->
<!--                    </li>-->
<!--                    <li>Shipping<span class="cart-total-amount">Free</span>-->
<!--                    </li>-->
<!--                    <li>Total<span class="cart-total-amount">Rs.650</span>-->
<!--                    </li>-->
<!--                </ul>-->
                <a class="default-btn" onclick="checkOut()">直接結帳</a>
                <a class="default-btn" href="checkout-page.html">(暫棄)結帳</a>
            </div>

        </div>

    </section>


</div>

<!-- Footer Area Start Here -->
<footer>
    <div class="footer-area-top section-space">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                    <div class="footer-box">
                        <h3 class="title-bar-footer">About Cafe</h3>
                        <div class="footer-about">
                            <p>We aim to home-produce as much as possiblefor the best quality, and to reduce food mcious
                                cakes, traditional Devon soups, sauces and accompanimentsion.We aim to home-produce as
                                much as possiblefor the best quality, and to reduce food mcious cakes.</p>
                        </div>
                        <ul class="footer-social">
                            <li><a href="#"><i class="fa fa-facebook" aria-hidden="true"></i></a></li>
                            <li><a href="#"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
                            <li><a href="#"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li>
                            <li><a href="#"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li>
                            <li><a href="#"><i class="fa fa-rss" aria-hidden="true"></i></a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                    <div class="footer-box">
                        <h3 class="title-bar-footer">Our Category</h3>
                        <div class="footer-blog-post">
                            <div class="media">
                                <!-- <a href="#" class="pull-left">
                                     <img src="img/footer-blog1.jpg" alt="footer-blog" class="img-responsive">
                                 </a>-->
                                <div class="media-body">
                                    <h4><a href="#">Restaurant</a></h4>
                                    <!-- <p>20 Aug, 2016</p>-->
                                </div>
                            </div>
                        </div>
                        <div class="footer-blog-post">
                            <div class="media">
                                <!--<a href="#" class="pull-left">
                                    <img src="img/footer-blog2.jpg" alt="footer-blog" class="img-responsive">
                                </a>-->
                                <div class="media-body">
                                    <h4><a href="#">Bakery</a></h4>
                                    <!-- <p>20 Aug, 2016</p>-->
                                </div>
                            </div>
                        </div>
                        <div class="footer-blog-post">
                            <div class="media">
                                <!--<a href="#" class="pull-left">
                                    <img src="img/footer-blog3.jpg" alt="footer-blog" class="img-responsive">
                                </a>-->
                                <div class="media-body">
                                    <h4><a href="#">Sweets</a></h4>
                                    <!-- <p>20 Aug, 2016</p>-->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                    <div class="footer-box">
                        <h3 class="title-bar-footer">Opening Hours</h3>
                        <ul class="opening-schedule">
                            <li>Monday<span> 5pm - 11pm</span></li>
                            <li>Tuesday<span> 5pm - 11pm</span></li>
                            <li>Wednesday <span> Closed</span></li>
                            <li>Thursday<span> 5pm - Midnight</span></li>
                            <li>Friday<span> 4:30pm - Midnight</span></li>
                            <li>Saturday <span> 5pm - 11pm</span></li>
                            <li>Sunday<span> 5pm - 11pm</span></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="footer-area-bottom">
        <div class="container">
            <p>&copy; 2016 Vaishali All Rights Reserved. </p>
        </div>
    </div>
</footer>

<!-- Preloader Start Here -->
<div id="preloader"></div>
<!-- Preloader End Here -->

<!--=============================================
 jquery
 =====================================================-->
<script src="js/jquery-2.2.4.min.js" type="text/javascript"></script>

<!-- Plugins js -->
<script src="js/plugins.js" type="text/javascript"></script>

<!-- Bootstrap js -->
<script src="js/bootstrap.min.js" type="text/javascript"></script>

<!-- WOW JS -->
<script src="js/wow.min.js"></script>

<!-- Nivo slider js -->
<script src="vendor/slider/js/jquery.nivo.slider.js" type="text/javascript"></script>
<script src="vendor/slider/js/home.js" type="text/javascript"></script>

<!-- Owl Cauosel JS -->
<script src="vendor/OwlCarousel/owl.carousel.min.js" type="text/javascript"></script>

<!-- Meanmenu Js -->
<script src="js/jquery.meanmenu.min.js" type="text/javascript"></script>

<!-- Srollup js -->
<script src="js/jquery.scrollUp.min.js" type="text/javascript"></script>

<!-- jquery.counterup js -->
<script src="js/jquery.counterup.min.js"></script>
<script src="js/waypoints.min.js"></script>

<!-- Switch js -->
<script src="js/switch-style.js" type="text/javascript"></script>

<!-- Date Time Picker Js -->
<script src="js/jquery.datetimepicker.full.min.js" type="text/javascript"></script>

<!-- Validator js -->
<script src="js/validator.min.js" type="text/javascript"></script>

<!-- Custom Js -->
<script src="js/main.js" type="text/javascript"></script>
<script src="js/tool.js"></script>

<script>
     function makePostRequestList(data,url) {
              console.log("post request:"+data+"\turl:"+url);
              var xhr = new XMLHttpRequest();
              xhr.open("post",url, true);
              xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
              xhr.send(data);
              xhr.onload = function() {
                let response = JSON.parse(this.response);
                console.log(response)
                addDatasList(response)
              };
     }

     function addDatasList(datas) {
               //劣化版
            console.log("顯示賣家商品管理");
            var key=Object.keys(datas[0]);
            var total=0;

            for ( let data of datas ) {
                let productCountId=data.orderID+'Count';
                let productPriceId=data.orderID+'Price';
                let html='';
                html+="<tr id='"+ data.orderID+"'>";
                html+="<td class='cart-item-image'><a href='"+data.imageUrl+"'><img src='"+data.imageUrl+"' alt='Image Alternative text' title='Image Title' /></a></td>"
                html+="<td><a href='product-images.html' >"+data.productName+"</a></td>"
                html+=" <td> "+data.price+"</td>"
                html+="<td class='cart-item-quantity'><i class='fa fa-minus cart-item-minus'></i><input class='cart-quantity' type='text' name='cart-quantity' id='"+productCountId+"' value='"+data.count+"'/><i class='fa fa-plus cart-item-plus'></i></td>"
                html+=" <td><p id='"+productPriceId+"'>"+data.price+"</p></td>"
                html+=" <td class='cart-item-remove'><a class='' href='#'><i class='fa fa-trash' aria-hidden='true'></i></a></td>"
                html+="</tr>"
                $('#dataList1').append(html)
                let productCount = parseInt(document.getElementById(productCountId).value);
                let productPrice = parseInt(document.getElementById(productPriceId).innerText);
                document.getElementById(productPriceId).innerHTML=productCount*productPrice
                total+=productCount*productPrice;
            }
            let html="";
            html+="<li>小記<span class='cart-total-amount'>Tw."+total+"</span>"
            html+="<li>運費<span class='cart-total-amount'>60</span></li>"
            html+="<li>總和<span class='cart-total-amount'>Tw."+(total+60)+"</span></li>"
            $('#dataList2').append(html)


     }


     function update(){
<!--        //待改-->
         var temp=true,state="下單中";
         var data="email="+getCookie("email")+"&state="+state,url="/api/getFullOrder2";
         console.log("post request:"+data+"\turl:"+url);
         var xhr = new XMLHttpRequest();
         xhr.open("post",url, true);
         xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
         xhr.send(data);
         xhr.onload = function() {
             let response = JSON.parse(this.response);
             console.log(response)
             for ( let data of response ){
                 let productCountId=data.orderID+'Count';
                 var dataJSON = {};
                 dataJSON["orderId"] = data.orderID;
                 dataJSON["buyerEmail"] = getCookie('email');
                 dataJSON["count"] = parseInt(document.getElementById(productCountId).value);
                 let request="buyerEmail="+ dataJSON["buyerEmail"]+"&orderId="+dataJSON["orderId"]+"&count="+dataJSON["count"]
                 let url="/api/updataOrder";

                 console.log(request)
                 if(!updataPost(request,url)){
                    temp=false;
                 }
         }
<!--            判斷成功失敗??-->
            alert('更新成功')
            window.location.replace("/cart.html");
<!--            window.location.replace("/index1.html");-->
         }
     };


    function  updataPost(data,url) {
              //https://ithelp.ithome.com.tw/articles/10212110?sc=rss.qu
              console.log("post request:"+data+"\turl:"+url);
              var xhr = new XMLHttpRequest();
              xhr.open("post",url, true);
              xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
              xhr.send(data);
              xhr.onload = function() {
                let response = JSON.parse(this.response);
                console.log(response)
              };
    }





     function checkOut(){
     ///直接索取html資料 簡單但有風險
        var arr = [];
        $("#dataList1 tr").each(function() {
            arr.push(this.id);
        });
        for(data of arr){
            let url="/api/checkOrder";
            let request="orderId="+data+"&state=結帳中"
            updataPost(request,url);
        }
        console.log(arr);
        alert("結帳成功")
        window.location.replace("/index1.html");

    }
     $( document ).ready( function() {
        console.log( "ready!!!!" );
        var state="下單中"
        var data="email="+getCookie("email")+"&state="+state,url="/api/getFullOrder2";
        makePostRequestList(data,url);
        makePostRequestRight(data,url)
     });




</script>
</body>
</html>
