!function(a){a.betterWeather=function(d,b){var c=this;c.$el=a(d),c.el=d,c.$el.data("betterWeather",c),c.tries=1,c.templateInitialized=!1,c.retina=window.devicePixelRatio>1,c.defaultOptions={source:"forecast",apiKey:"",location:"",locationName:"",showLocation:!0,showDate:!0,visitorLocation:!1,fontColor:"#fff",bgColor:"#4f4f4f",style:"normal",nextDays:!0,animatedIcons:!0,naturalBackground:!0,url:"better-weather/ajax/ajax.php",unit:"C",showUnit:!1,mode:"widget",inlineSize:"medium"},c.elements={location:"",date:"",currentlyDegree:"",upDegree:"",summary:"",summaryIconContainer:"",day1Title:"",day1Degree:"",day1IconContainer:"",day2Title:"",day2Degree:"",day2IconContainer:"",day3Title:"",day3Degree:"",day3IconContainer:"",day4Title:"",day4Degree:"",day4IconContainer:""},c.monthList={January:"January",February:"February",March:"March",April:"April",May:"May",June:"June",July:"July",August:"August",September:"September",October:"October",November:"November",December:"December"},c.daysList={Sat:"Sat",Sun:"Sun",Mon:"Mon",Tue:"Tue",Wed:"Wed",Thu:"Thu",Fri:"Fri"},c.stateList={clear:"Clear",rain:"Rain",snow:"Snow",sleet:"Sleet",wind:"Wind",foggy:"Foggy",cloudy:"Cloudy",mostly_cloudy:"Mostly Cloudy",partly_cloudy:"Partly Cloudy",thunderstorm:"Thunderstorm",drizzle:"Drizzle",light_Rain:"Light Rain",breezy_and_Partly_Cloudy:"breezy and Partly Cloudy",overcast:"Overcast"},c.data={latitude:"",longitude:"",timezone:"",currently:{time:"",summary:"",icon:"",nearestStormDistance:"",nearestStormBearing:"",precipIntensity:"",precipProbability:"",temperature:"",apparentTemperature:"",dewPoint:"",humidity:"",windSpeed:"",windBearing:"",visibility:"",cloudCover:"",pressure:"",ozone:"",temperatureMin:"",temperatureMax:"",sunriseTime:"",sunsetTime:""},daily:[{dayName:"",time:"",icon:""},{dayName:"",time:"",icon:""},{dayName:"",time:"",icon:""},{dayName:"",time:"",icon:""}]},c.init=function(){if(c.options=a.extend({},c.defaultOptions,b),c.helper.showLoader(),c.initColor(),c.initStyle(),""===c.options.apiKey){if("undefined"==typeof BW_Localized||null===BW_Localized||"undefined"==typeof BW_Localized.apiKey||null===BW_Localized.apiKey){return c.helper.hideLoader(),void c.helper.log("error","No API Key provided! "," Obtain API Key from https://developers.forecast.io")}c.options.apiKey=BW_Localized.apiKey}c.getDataAjax()},c.initTemplate=function(){c.helper.cleanLog(),c.templateInitialized!==!0&&(c.templateInitialized=!0,"widget"===c.options.mode?(c.options.naturalBackground&&c.$el.addClass("with-natural-background"),c.options.showUnit&&c.$el.addClass("unit-showed"),c.$el.append(c.helper.templateWidgetCurrently),c.options.showLocation?c.elements.location=c.$el.find(".bw_currently .bw_location"):(c.$el.find(".bw_currently .bw_location").remove(),c.$el.find(".bw_currently .bw_separator").remove()),c.options.showDate?c.elements.date=c.$el.find(".bw_currently .bw_date"):(c.$el.find(".bw_currently .bw_date").remove(),c.$el.find(".bw_currently .bw_separator").remove()),c.elements.currentlyDegree=c.$el.find(".bw_currently .bw_degree"),c.elements.upDegree=c.$el.find(".bw_currently .bw_up-degree"),c.elements.downDegree=c.$el.find(".bw_currently .bw_down-degree"),c.elements.summaryIconContainer=c.$el.find(".bw_currently .bw_summary .bw_icon-container"),c.elements.summary=c.$el.find(".bw_currently .bw_summary p"),c.options.nextDays&&(c.$el.addClass("have-next-days"),c.$el.append(c.helper.templateWidgetNextDays),c.elements.day1Title=c.$el.find(".bw_days .bw_day-1 .bw_day-title"),c.elements.day1IconContainer=c.$el.find(".bw_days .bw_day-1 .bw_icon-container"),c.elements.day2Title=c.$el.find(".bw_days .bw_day-2 .bw_day-title"),c.elements.day2IconContainer=c.$el.find(".bw_days .bw_day-2 .bw_icon-container"),c.elements.day3Title=c.$el.find(".bw_days .bw_day-3 .bw_day-title"),c.elements.day3IconContainer=c.$el.find(".bw_days .bw_day-3 .bw_icon-container"),c.elements.day4Title=c.$el.find(".bw_days .bw_day-4 .bw_day-title"),c.elements.day4IconContainer=c.$el.find(".bw_days .bw_day-4 .bw_icon-container")),c.initIcons(),c.prettifyIconSize(),a(window).resize(function(){c.prettifyIconSize()})):"inline"===c.options.mode&&(c.$el.append(c.helper.templateInlineCurrently),c.elements.summaryIconContainer=c.$el.find(".bw_icon_container"),c.elements.currentlyDegree=c.$el.find(".bw_temperature"),c.elements.summary=c.$el.find(".bw_summary"),c.initIcons()))},c.refreshData=function(){if("widget"===c.options.mode){c.$el.addClass("state-"+c.data.currently.icon);var g=new Date(1000*c.data.currently.sunriseTime),n=new Date(1000*c.data.currently.sunsetTime),f=new Date,h=new Date(f.getTime()+-1800000),k=new Date(f.getTime()+1800000);if(g>=h&&k>=g?(c.$el.removeClass("state-"+c.data.currently.icon),c.$el.addClass("state-sunrise")):n>=h&&k>=n&&(c.$el.removeClass("state-"+c.data.currently.icon),c.$el.addClass("state-sunset")),c.helper.setIconTo(c.data.currently.icon,c.elements.summaryIconContainer.find(".bw_icon")),c.elements.summary.text(c.helper.getStateName(c.data.currently.summary)),c.elements.currentlyDegree.find("p").text(c.helper.getPrettyTemperature(c.data.currently.temperature)),c.elements.upDegree.text(c.helper.getPrettyTemperature(c.data.currently.temperatureMax)),c.elements.downDegree.text(c.helper.getPrettyTemperature(c.data.currently.temperatureMin)),c.options.showDate){var m=new Date(1000*c.data.currently.time);c.elements.date.text(m.getDate()+" "+c.helper.getMonth(m.getMonth()+1))}if(c.options.showLocation){if(""!==c.options.locationName){c.elements.location.text(c.options.locationName)}else{var j=c.data.timezone;j=j.split("/"),j=j[j.length-1].replace("_"," "),c.elements.location.text(j)}}c.options.nextDays&&(c.helper.setIconTo(c.data.daily[1].icon,c.elements.day1IconContainer.find(".bw_icon")),c.elements.day1Title.text(c.helper.getDayName(c.data.daily[1].dayName)),c.helper.setIconTo(c.data.daily[2].icon,c.elements.day2IconContainer.find(".bw_icon")),c.elements.day2Title.text(c.helper.getDayName(c.data.daily[2].dayName)),c.helper.setIconTo(c.data.daily[3].icon,c.elements.day3IconContainer.find(".bw_icon")),c.elements.day3Title.text(c.helper.getDayName(c.data.daily[3].dayName)),c.helper.setIconTo(c.data.daily[4].icon,c.elements.day4IconContainer.find(".bw_icon")),c.elements.day4Title.text(c.helper.getDayName(c.data.daily[4].dayName)))}else{"inline"===c.options.mode&&(c.$el.addClass("state-"+c.data.currently.icon),c.helper.setIconTo(c.data.currently.icon,c.elements.summaryIconContainer.find(".bw_icon")),c.elements.summary.text(c.helper.getStateName(c.data.currently.summary)),c.elements.currentlyDegree.text(c.helper.getPrettyTemperature(c.data.currently.temperature)))}},c.emptyData=function(){if("inline "!==c.options.mode){if(c.initTemplate(),c.$el.addClass("state-no-data"),c.elements.summary.text("N/A"),c.elements.currentlyDegree.find("p").text("N/A"),c.elements.upDegree.text("N/A"),c.elements.downDegree.text("N/A"),c.options.showDate){var f=new Date;c.elements.date.text(f.getDate()+" "+c.helper.getMonth(f.getMonth()+1))}c.options.showLocation&&c.elements.location.text(""!==c.options.locationName?c.options.locationName:"N/A"),c.options.nextDays&&(c.elements.day1Title.text("N/A"),c.elements.day2Title.text("N/A"),c.elements.day3Title.text("N/A"),c.elements.day4Title.text("N/A"))}},c.initColor=function(){"widget"===c.options.mode&&(c.options.naturalBackground||c.$el.css("background-color",c.options.bgColor)),c.$el.css("color",c.options.fontColor)},c.initStyle=function(){"widget"===c.options.mode?(c.$el.addClass("style-"+c.options.style),c.$el.addClass("better-weather")):"inline"===c.options.mode&&(c.$el.addClass("bw_size-"+c.options.inlineSize),c.$el.addClass("better-weather-inline"))},c.initIcons=function(){if("widget"===c.options.mode){c.helper.isCanvasSupported()&&(c.skycons=new Skycons({color:c.options.fontColor,dropShadow:!0})),"normal"===c.options.style?c.helper.addCanvasTo(c.elements.summaryIconContainer,c.$el.attr("id")+"-summary-icon",85,85):c.helper.addCanvasTo(c.elements.summaryIconContainer,c.$el.attr("id")+"-summary-icon",55,55),c.options.nextDays&&(c.helper.addCanvasTo(c.elements.day1IconContainer,c.$el.attr("id")+"-day1-icon",17,17),c.helper.addCanvasTo(c.elements.day2IconContainer,c.$el.attr("id")+"-day2-icon",17,17),c.helper.addCanvasTo(c.elements.day3IconContainer,c.$el.attr("id")+"-day3-icon",17,17),c.helper.addCanvasTo(c.elements.day4IconContainer,c.$el.attr("id")+"-day4-icon",17,17))}else{if("inline"===c.options.mode){c.helper.isCanvasSupported()&&(c.skycons=new Skycons({color:c.options.fontColor,dropShadow:!1}));var f="",g="";switch(c.options.inlineSize){case"small":g=f=18;break;case"medium":g=f=30;break;case"large":g=f=55}c.helper.addCanvasTo(c.elements.summaryIconContainer,c.$el.attr("id")+"-summary-icon",f,g)}}},c.prettifyIconSize=function(){var f=c.$el.width(),g=c.elements.summaryIconContainer.find(".bw_icon");if(!g.hasClass("hw_static-icon")){switch(!0){case 70>=f:c.helper.updateIconSize(g,28,28);break;case 100>=f:c.helper.updateIconSize(g,35,35);break;case 200>=f:c.helper.updateIconSize(g,40,40);break;case 400>=f:"modern"===c.options.style?c.helper.updateIconSize(g,55,55):"normal"===c.options.style&&c.helper.updateIconSize(g,70,70);break;case 1170>=f:c.helper.updateIconSize(g,35,35)}}},c.getDataAjax=function(){var f="location="+c.options.location;f+="&apikey="+c.options.apiKey,f+="&source="+c.options.source,c.options.visitorLocation&&(f+="&visitor_location=true"),jQuery.ajax({type:"POST",url:c.helper.getAjaxURL(),data:f,dataType:"json",success:function(g){switch(g.status){case"succeed":c.data=g.data,c.initTemplate(),c.helper.hideLoader(),c.refreshData();break;case"error":c.initTemplate(),c.helper.log("error",g.msg,g.data),c.tries<=2?(c.tries++,c.helper.log("alert","Better Weather Another Ajax call sent",""),setTimeout(function(){c.helper.log("alert","Better Weather another Ajax call sent.",""),c.getDataAjax()},3000)):(c.helper.log("error","Critical problem in Better Weather Ajax calls","Better Weather sent 3 time Ajax Call but retried data has problem! Please check xml.php file and delete cache folder."),setTimeout(function(){c.emptyData(),c.helper.hideLoader()},2000))}}})},c.helper={getCorretSize:function(f){return c.retina?2*f:f},updateIconSize:function(g,h,f){g.attr("width",c.helper.getCorretSize(h)),g.attr("height",c.helper.getCorretSize(f)),g.css("width",h+"px"),g.css("height",f+"px")},getAjaxURL:function(){return c.options.url!==c.defaultOptions.url?c.options.url:"undefined"!=typeof BW_Localized&&null!==BW_Localized&&"undefined"!=typeof BW_Localized.url&&null!==BW_Localized.url?BW_Localized.url:c.defaultOptions.url},showLoader:function(){"inline"!==c.options.mode&&0===c.$el.find(".bw-loader").length&&c.$el.append(c.helper.templateWidgetLoader)},hideLoader:function(){"inline"!==c.options.mode&&c.$el.find(".bw-loader").remove()},celsiusToFahrenheit:function(f){return 9*f/5+32},fahrenheitToCelsius:function(f){return 5*(f-32)/9},getPrettyTemperature:function(f){return"widget"===c.options.mode?"F"===c.options.unit?parseInt(f)+"°"+(c.options.showUnit?"F":""):parseInt(c.helper.fahrenheitToCelsius(f))+"°"+(c.options.showUnit?"C":""):"inline"===c.options.mode?"F"===c.options.unit?parseInt(f)+"°"+(c.options.showUnit?"F":""):parseInt(c.helper.fahrenheitToCelsius(f))+"°"+(c.options.showUnit?"F":""):void 0},getMonth:function(f){var g="";switch(f){case 1:g="January";break;case 2:g="February";break;case 3:g="March";break;case 4:g="April";break;case 5:g="May";break;case 6:g="June";break;case 7:g="July";break;case 8:g="August";break;case 9:g="September";break;case 10:g="October";break;case 11:g="November";break;case 12:g="December"}return"undefined"!=typeof BW_Localized&&null!==BW_Localized&&"undefined"!=typeof BW_Localized.monthList&&null!==BW_Localized.monthList&&"undefined"!=typeof BW_Localized.monthList[g]&&null!==BW_Localized.monthList[g]?BW_Localized.monthList[g]:c.monthList[g]},getDayName:function(f){return"undefined"!=typeof BW_Localized&&null!==BW_Localized&&"undefined"!=typeof BW_Localized.daysList&&null!==BW_Localized.daysList&&"undefined"!=typeof BW_Localized.daysList[f]&&null!==BW_Localized.daysList[f]?BW_Localized.daysList[f]:c.daysList[f]},getStateName:function(f){var g=f.toLowerCase();return g=g.replace(" ","_"),g=g.replace("-","_"),"undefined"!=typeof BW_Localized&&null!==BW_Localized&&"undefined"!=typeof BW_Localized.stateList&&null!==BW_Localized.stateList&&"undefined"!=typeof BW_Localized.stateList[g]&&null!==BW_Localized.stateList[g]?BW_Localized.stateList[g]:"undefined"!=typeof c.stateList[g]&&null!==c.stateList[g]?c.stateList[g]:f},log:function(g,h,f){switch(g){case"error":"widget"===c.options.mode?(0===c.$el.find(".bw-error").length&&c.$el.append(c.helper.templateWidgetErrors),c.$el.find(".bw-error .bw-error-title").text(h),console.log((""===h?"":h+":")+f)):console.log((""===h?"":h+":")+f);break;case"alert":console.log((""===h?"":h+":")+f)}},cleanLog:function(){c.$el.find(".bw-error").remove()},isCanvasSupported:function(){var f=document.createElement("canvas");return !(!f.getContext||!f.getContext("2d"))},allowedIcons:["clear-day","clear-night","rain","snow","sleet","wind","fog","cloudy","partly-cloudy-day","partly-cloudy-night"],setIconTo:function(g,e){if(c.helper.isCanvasSupported()&&a.inArray(g,c.helper.allowedIcons)>=0&&c.options.animatedIcons===!0){c.skycons.set(e.attr("id"),g),c.skycons.play()}else{e.addClass("bw_"+g);var f="";switch(g){case"clear-day":f="wi-day-sunny";break;case"clear-night":f="wi-night-clear";break;case"rain":f="wi-rain";break;case"snow":f="wi-snow";break;case"sleet":f="wi-rain";break;case"wind":f="wi-strong-wind";break;case"thunderstorm":f="wi-lightning";break;case"cloudy":f="wi-cloudy";break;case"partly-cloudy-day":f="wi-day-cloudy";break;case"partly-cloudy-night":f="wi-night-cloudy"}"thunderstorm"===g?(e.parent().append('<i class="'+f+'"></i>'),e.parent().find("canvas").remove()):e.append('<i class="'+f+'"></i>')}},addCanvasTo:function(g,j,f,h){g.append(c.helper.isCanvasSupported()&&c.options.animatedIcons===!0?'<canvas id="'+j+'" class="bw_icon bw_svg-icon" width="'+c.helper.getCorretSize(f)+'" height="'+c.helper.getCorretSize(h)+'" style="height:'+h+"px; width:"+f+'px;"></canvas>':'<span id="'+j+'" class="bw_icon hw_static-icon" ></span>')},templateInlineCurrently:'<span class="bw_icon_container"></span><span class="bw_temperature"></span><span class="bw_summary"></span>',templateWidgetErrors:'<div class="bw-error"><p class="bw-error-sign">&#x26a0;</p><p class="bw-error-title"></p><p class="bw-error-text"></p></div>',templateWidgetLoader:'<div class="bw-loader"></div>',templateWidgetCurrently:'<div class="bw_currently"><div class="bw_date-loc"><span class="bw_location"></span><span class="bw_separator">-</span><span class="bw_date"></span></div><div class="bw_degree-up-down"><span class="bw_up-degree"></span><span class="bw_down-degree"></span></div><div class="bw_summary"><span class="bw_icon-container"></span><p></p></div><div class="bw_degree"><p></p></div></div>',templateWidgetNextDays:'<div class="bw_days"><ul class="bw_days-list"><li class="bw_day-item bw_day-1"><p class="bw_day-title"></p><span class="bw_icon-container"></span></li><li class="bw_day-item bw_day-2"><p class="bw_day-title"></p><span class="bw_icon-container"></span></li><li class="bw_day-item bw_day-3"><p class="bw_day-title"></p><span class="bw_icon-container"></span></li><li class="bw_day-item bw_day-4"><p class="bw_day-title"></p><span class="bw_icon-container"></span></li></ul></div>'},c.init()},a.fn.betterWeather=function(b){return this.each(function(){new a.betterWeather(this,b)})},elementQuery({".better-weather":{"max-width":["2000px","1170px","970px","900px","830px","650px","550px","400px","350px","300px","250px","200px","170px","120px","100px","50px"]}})}(jQuery);